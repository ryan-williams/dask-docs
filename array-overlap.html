








<!DOCTYPE html>
<html lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Overlapping Computations &mdash; Dask 2.13.0+4.gf26bb993.dirty documentation</title>
  

  
  
  
  

  
  <link rel="stylesheet" href="_static/css/style.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/theme_overrides.css" type="text/css" />
  <link rel="stylesheet" href="_static/style.css" type="text/css" />
  <link rel="stylesheet" href="_static/css/explore.css" type="text/css" />
  <link rel="stylesheet" href="_static/css/nbsphinx.css" type="text/css" />

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/language_data.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
        <script src="_static/js/custom.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Internal Design" href="array-design.html" />
    <link rel="prev" title="Create Dask Arrays" href="array-creation.html" />
    <link rel="shortcut icon" href="_static/images/favicon.ico"/>
  
</head>

<body class="wy-body-for-nav">

  
    <nav id="explore-links">
        <a href="https://docs.dask.org/">
        <img class="caption" src="_static/images/dask-horizontal-white.svg"/>
        </a>

        <ul>
        <li>
            <a>Get Started</a>
            <ul>
            <li><a href="https://docs.dask.org/en/latest/install.html"> Install </a></li>
            <li><a href="https://examples.dask.org"> Examples </a></li>
            <li><a href="https://github.com/dask/dask-tutorial"> Tutorial </a></li>
            <li><a href="https://docs.dask.org/en/latest/why.html"> Why Dask? </a></li>
            <li><a href="https://stories.dask.org/en/latest"> Use Cases </a></li>
            <li><a href="https://www.youtube.com/watch?v=RA_2qdipVng&list=PLRtz5iA93T4PQvWuoMnIyEIz1fXiJ5Pri"> Talks </a></li>
            <li><a href="https://mybinder.org/v2/gh/dask/dask-examples/master?urlpath=lab"> Try Online </a></li>
            <li><a href="https://dask.org/slides"> Slides </a></li>
            </ul>
        </li>

        <li>
            <a href="">Algorithms</a>
            <ul>
            <li><a href="https://docs.dask.org/en/latest/array.html">Arrays</a></li>
            <li><a href="https://docs.dask.org/en/latest/dataframe.html">Dataframes</a></li>
            <li><a href="https://docs.dask.org/en/latest/bag.html">Bags</a></li>
            <li><a href="https://docs.dask.org/en/latest/delayed.html">Delayed (custom)</a></li>
            <li><a href="https://docs.dask.org/en/latest/futures.html">Futures (real-time)</a></li>
            <li><a href="http://ml.dask.org">Machine Learning</a></li>
            <li><a href="https://xarray.pydata.org/en/latest/">XArray</a></li>
            </ul>
        </li>

        <li>
            <a href="https://docs.dask.org/en/latest/setup.html">Setup</a>
            <ul>
            <li><a href="https://docs.dask.org/en/latest/setup/single-machine.html"> Local </a></li>
            <li><a href="https://docs.dask.org/en/latest/setup/cloud.html"> Cloud </a></li>
            <li><a href="https://docs.dask.org/en/latest/setup/hpc.html"> HPC </a></li>
            <li><a href="https://kubernetes.dask.org/en/latest/"> Kubernetes </a></li>
            <li><a href="https://yarn.dask.org/en/latest/"> Hadoop / Yarn </a></li>
            </ul>
        </li>

        <li>
            <a>Community</a>
            <ul>
            <li><a href="http://docs.dask.org/en/latest/support.html">Ask for Help</a></li>
            <li><a href="https://github.com/dask">Github</a></li>
            <li><a href="https://stackoverflow.com/questions/tagged/dask">Stack Overflow</a></li>
            <li><a href="https://twitter.com/dask_dev">Twitter</a></li>
            <li><a href="https://blog.dask.org/"> Developer Blog </a></li>
            </ul>
        </li>
        </ul>

    </nav>
  
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home" alt="Documentation Home"> Dask
          

          
          </a>

          
            
            
              <div class="version">
                2.13.0+4.gf26bb993.dirty
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="install.html">Install Dask</a></li>
<li class="toctree-l1"><a class="reference internal" href="setup.html">Setup</a></li>
<li class="toctree-l1"><a class="reference external" href="https://stories.dask.org">Use Cases</a></li>
<li class="toctree-l1"><a class="reference internal" href="support.html">Community</a></li>
<li class="toctree-l1"><a class="reference internal" href="why.html">Why Dask?</a></li>
<li class="toctree-l1"><a class="reference internal" href="institutional-faq.html">Institutional FAQ</a></li>
</ul>
<p class="caption"><span class="caption-text">User Interface</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="user-interfaces.html">User Interfaces</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="array.html">Array</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="array-api.html">API</a></li>
<li class="toctree-l2"><a class="reference internal" href="array-best-practices.html">Best Practices</a></li>
<li class="toctree-l2"><a class="reference internal" href="array-chunks.html">Chunks</a></li>
<li class="toctree-l2"><a class="reference internal" href="array-creation.html">Create Dask Arrays</a></li>
<li class="toctree-l2"><a class="reference internal" href="array-creation.html#store-dask-arrays">Store Dask Arrays</a></li>
<li class="toctree-l2"><a class="reference internal" href="array-creation.html#plugins">Plugins</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Overlapping Computations</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#explanation">Explanation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#boundaries">Boundaries</a></li>
<li class="toctree-l3"><a class="reference internal" href="#map-a-function-across-blocks">Map a function across blocks</a></li>
<li class="toctree-l3"><a class="reference internal" href="#trim-excess">Trim Excess</a></li>
<li class="toctree-l3"><a class="reference internal" href="#full-workflow">Full Workflow</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="array-design.html">Internal Design</a></li>
<li class="toctree-l2"><a class="reference internal" href="array-sparse.html">Sparse Arrays</a></li>
<li class="toctree-l2"><a class="reference internal" href="array-stats.html">Stats</a></li>
<li class="toctree-l2"><a class="reference internal" href="array-linear-operator.html">LinearOperator</a></li>
<li class="toctree-l2"><a class="reference internal" href="array-slicing.html">Slicing</a></li>
<li class="toctree-l2"><a class="reference internal" href="array-stack.html">Stack, Concatenate, and Block</a></li>
<li class="toctree-l2"><a class="reference internal" href="array-gufunc.html">Generalized Ufuncs</a></li>
<li class="toctree-l2"><a class="reference internal" href="array.html#examples">Examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="array.html#design">Design</a></li>
<li class="toctree-l2"><a class="reference internal" href="array.html#common-uses">Common Uses</a></li>
<li class="toctree-l2"><a class="reference internal" href="array.html#scope">Scope</a></li>
<li class="toctree-l2"><a class="reference internal" href="array.html#execution">Execution</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="bag.html">Bag</a></li>
<li class="toctree-l1"><a class="reference internal" href="dataframe.html">DataFrame</a></li>
<li class="toctree-l1"><a class="reference internal" href="delayed.html">Delayed</a></li>
<li class="toctree-l1"><a class="reference internal" href="futures.html">Futures</a></li>
<li class="toctree-l1"><a class="reference external" href="https://ml.dask.org">Machine Learning</a></li>
<li class="toctree-l1"><a class="reference internal" href="best-practices.html">Best Practices</a></li>
<li class="toctree-l1"><a class="reference internal" href="api.html">API</a></li>
</ul>
<p class="caption"><span class="caption-text">Scheduling</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="scheduling.html">Scheduling</a></li>
<li class="toctree-l1"><a class="reference external" href="https://distributed.dask.org/">Distributed Scheduling</a></li>
</ul>
<p class="caption"><span class="caption-text">Diagnostics</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="understanding-performance.html">Understanding Performance</a></li>
<li class="toctree-l1"><a class="reference internal" href="graphviz.html">Visualize task graphs</a></li>
<li class="toctree-l1"><a class="reference internal" href="diagnostics-local.html">Diagnostics (local)</a></li>
<li class="toctree-l1"><a class="reference internal" href="diagnostics-distributed.html">Diagnostics (distributed)</a></li>
<li class="toctree-l1"><a class="reference internal" href="debugging.html">Debugging</a></li>
</ul>
<p class="caption"><span class="caption-text">Help &amp; reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="develop.html">Development Guidelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="changelog.html">Changelog</a></li>
<li class="toctree-l1"><a class="reference internal" href="configuration.html">Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="educational-resources.html">Educational Resources</a></li>
<li class="toctree-l1"><a class="reference internal" href="presentations.html">Presentations On Dask</a></li>
<li class="toctree-l1"><a class="reference internal" href="cheatsheet.html">Dask Cheat Sheet</a></li>
<li class="toctree-l1"><a class="reference internal" href="spark.html">Comparison to Spark</a></li>
<li class="toctree-l1"><a class="reference internal" href="caching.html">Opportunistic Caching</a></li>
<li class="toctree-l1"><a class="reference internal" href="graphs.html">Task Graphs</a></li>
<li class="toctree-l1"><a class="reference internal" href="remote-data-services.html">Remote Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="gpu.html">GPUs</a></li>
<li class="toctree-l1"><a class="reference internal" href="cite.html">Citations</a></li>
<li class="toctree-l1"><a class="reference internal" href="funding.html">Funding</a></li>
<li class="toctree-l1"><a class="reference internal" href="logos.html">Images and Logos</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Dask</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
          <li><a href="array.html">Array</a> &raquo;</li>
        
      <li>Overlapping Computations</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/array-overlap.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="overlapping-computations">
<h1>Overlapping Computations<a class="headerlink" href="#overlapping-computations" title="Permalink to this headline">¶</a></h1>
<p>Some array operations require communication of borders between neighboring
blocks.  Example operations include the following:</p>
<ul class="simple">
<li><p>Convolve a filter across an image</p></li>
<li><p>Sliding sum/mean/max, …</p></li>
<li><p>Search for image motifs like a Gaussian blob that might span the border of a
block</p></li>
<li><p>Evaluate a partial derivative</p></li>
<li><p>Play the game of <a class="reference external" href="https://en.wikipedia.org/wiki/Conway%27s_Game_of_Life">Life</a></p></li>
</ul>
<p>Dask Array supports these operations by creating a new array where each
block is slightly expanded by the borders of its neighbors.  This costs an
excess copy and the communication of many small chunks, but allows localized
functions to evaluate in an embarrassingly parallel manner.</p>
<p>The main API for these computations is the <code class="docutils literal notranslate"><span class="pre">map_overlap</span></code> method defined
below:</p>
<table class="longtable docutils align-default">
<colgroup>
<col style="width: 10%" />
<col style="width: 90%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><a class="reference internal" href="#dask.array.map_overlap" title="dask.array.map_overlap"><code class="xref py py-obj docutils literal notranslate"><span class="pre">map_overlap</span></code></a>(x, func, depth[, boundary, trim])</p></td>
<td><p>Map a function over blocks of the array with some overlap</p></td>
</tr>
</tbody>
</table>
<dl class="function">
<dt id="dask.array.map_overlap">
<code class="sig-prename descclassname">dask.array.</code><code class="sig-name descname">map_overlap</code><span class="sig-paren">(</span><em class="sig-param">x</em>, <em class="sig-param">func</em>, <em class="sig-param">depth</em>, <em class="sig-param">boundary=None</em>, <em class="sig-param">trim=True</em>, <em class="sig-param">**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#dask.array.map_overlap" title="Permalink to this definition">¶</a></dt>
<dd><p>Map a function over blocks of the array with some overlap</p>
<p>We share neighboring zones between blocks of the array, then map a
function, then trim away the neighboring strips.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>func: function</strong></dt><dd><p>The function to apply to each extended block</p>
</dd>
<dt><strong>depth: int, tuple, or dict</strong></dt><dd><p>The number of elements that each block should share with its neighbors
If a tuple or dict then this can be different per axis.
Asymmetric depths may be specified using a dict value of (-/+) tuples.
Note that asymmetric depths are currently only supported when
<code class="docutils literal notranslate"><span class="pre">boundary</span></code> is ‘none’.</p>
</dd>
<dt><strong>boundary: str, tuple, dict</strong></dt><dd><p>How to handle the boundaries.
Values include ‘reflect’, ‘periodic’, ‘nearest’, ‘none’,
or any constant value like 0 or np.nan</p>
</dd>
<dt><strong>trim: bool</strong></dt><dd><p>Whether or not to trim <code class="docutils literal notranslate"><span class="pre">depth</span></code> elements from each block after
calling the map function.
Set this to False if your mapping function already does this for you</p>
</dd>
<dt><strong>**kwargs:</strong></dt><dd><p>Other keyword arguments valid in <code class="docutils literal notranslate"><span class="pre">map_blocks</span></code></p>
</dd>
</dl>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">dask.array</span> <span class="k">as</span> <span class="nn">da</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="n">da</span><span class="o">.</span><span class="n">from_array</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">chunks</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">derivative</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="n">x</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">roll</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">y</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">map_overlap</span><span class="p">(</span><span class="n">derivative</span><span class="p">,</span> <span class="n">depth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">boundary</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">y</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span>
<span class="go">array([ 1,  0,  1,  1,  0,  0, -1, -1,  0])</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">16</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">d</span> <span class="o">=</span> <span class="n">da</span><span class="o">.</span><span class="n">from_array</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">chunks</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">d</span><span class="o">.</span><span class="n">map_overlap</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">+</span> <span class="n">x</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">depth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span>
<span class="go">array([[16, 17, 18, 19],</span>
<span class="go">       [20, 21, 22, 23],</span>
<span class="go">       [24, 25, 26, 27],</span>
<span class="go">       [28, 29, 30, 31]])</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">func</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">+</span> <span class="n">x</span><span class="o">.</span><span class="n">size</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">depth</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">boundary</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s1">&#39;reflect&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="s1">&#39;none&#39;</span><span class="p">}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">d</span><span class="o">.</span><span class="n">map_overlap</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">depth</span><span class="p">,</span> <span class="n">boundary</span><span class="p">)</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span>  
<span class="go">array([[12,  13,  14,  15],</span>
<span class="go">       [16,  17,  18,  19],</span>
<span class="go">       [20,  21,  22,  23],</span>
<span class="go">       [24,  25,  26,  27]])</span>
</pre></div>
</div>
</dd></dl>

<div class="section" id="explanation">
<h2>Explanation<a class="headerlink" href="#explanation" title="Permalink to this headline">¶</a></h2>
<p>Consider two neighboring blocks in a Dask array:</p>
<a class="reference internal image-reference" href="_images/unoverlapping-neighbors.png"><img alt="un-overlapping neighbors" src="_images/unoverlapping-neighbors.png" style="width: 30%;" /></a>
<p>We extend each block by trading thin nearby slices between arrays:</p>
<a class="reference internal image-reference" href="_images/overlapping-neighbors.png"><img alt="overlapping neighbors" src="_images/overlapping-neighbors.png" style="width: 30%;" /></a>
<p>We do this in all directions, including also diagonal interactions with the
overlap function:</p>
<a class="reference internal image-reference" href="_images/overlapping-blocks.png"><img alt="overlapping blocks" src="_images/overlapping-blocks.png" style="width: 40%;" /></a>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">dask.array</span> <span class="k">as</span> <span class="nn">da</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">64</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">d</span> <span class="o">=</span> <span class="n">da</span><span class="o">.</span><span class="n">from_array</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">chunks</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">d</span><span class="o">.</span><span class="n">chunks</span>
<span class="go">((4, 4), (4, 4))</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">g</span> <span class="o">=</span> <span class="n">da</span><span class="o">.</span><span class="n">overlap</span><span class="o">.</span><span class="n">overlap</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">depth</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span>
<span class="gp">... </span>                      <span class="n">boundary</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="s1">&#39;reflect&#39;</span><span class="p">})</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">g</span><span class="o">.</span><span class="n">chunks</span>
<span class="go">((8, 8), (6, 6))</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
<span class="go">array([[100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100],</span>
<span class="go">       [100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100],</span>
<span class="go">       [  0,   0,   1,   2,   3,   4,   3,   4,   5,   6,   7,   7],</span>
<span class="go">       [  8,   8,   9,  10,  11,  12,  11,  12,  13,  14,  15,  15],</span>
<span class="go">       [ 16,  16,  17,  18,  19,  20,  19,  20,  21,  22,  23,  23],</span>
<span class="go">       [ 24,  24,  25,  26,  27,  28,  27,  28,  29,  30,  31,  31],</span>
<span class="go">       [ 32,  32,  33,  34,  35,  36,  35,  36,  37,  38,  39,  39],</span>
<span class="go">       [ 40,  40,  41,  42,  43,  44,  43,  44,  45,  46,  47,  47],</span>
<span class="go">       [ 16,  16,  17,  18,  19,  20,  19,  20,  21,  22,  23,  23],</span>
<span class="go">       [ 24,  24,  25,  26,  27,  28,  27,  28,  29,  30,  31,  31],</span>
<span class="go">       [ 32,  32,  33,  34,  35,  36,  35,  36,  37,  38,  39,  39],</span>
<span class="go">       [ 40,  40,  41,  42,  43,  44,  43,  44,  45,  46,  47,  47],</span>
<span class="go">       [ 48,  48,  49,  50,  51,  52,  51,  52,  53,  54,  55,  55],</span>
<span class="go">       [ 56,  56,  57,  58,  59,  60,  59,  60,  61,  62,  63,  63],</span>
<span class="go">       [100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100],</span>
<span class="go">       [100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100]])</span>
</pre></div>
</div>
</div>
<div class="section" id="boundaries">
<h2>Boundaries<a class="headerlink" href="#boundaries" title="Permalink to this headline">¶</a></h2>
<p>With respect to overlapping, you can specify how to handle the boundaries.  Current policies
include the following:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">periodic</span></code> - wrap borders around to the other side</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">reflect</span></code> - reflect each border outwards</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">any-constant</span></code> - pad the border with this value</p></li>
</ul>
<p>An example boundary kind argument might look like the following:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s1">&#39;periodic&#39;</span><span class="p">,</span>
 <span class="mi">1</span><span class="p">:</span> <span class="s1">&#39;reflect&#39;</span><span class="p">,</span>
 <span class="mi">2</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">}</span>
</pre></div>
</div>
<p>Alternatively, you can use <a class="reference internal" href="array-api.html#dask.array.pad" title="dask.array.pad"><code class="xref py py-func docutils literal notranslate"><span class="pre">dask.array.pad()</span></code></a> for other types of
paddings.</p>
</div>
<div class="section" id="map-a-function-across-blocks">
<h2>Map a function across blocks<a class="headerlink" href="#map-a-function-across-blocks" title="Permalink to this headline">¶</a></h2>
<p>Overlapping goes hand-in-hand with mapping a function across blocks.  This
function can now use the additional information copied over from the neighbors
that is not stored locally in each block:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">scipy.ndimage.filters</span> <span class="kn">import</span> <span class="n">gaussian_filter</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="n">block</span><span class="p">):</span>
<span class="gp">... </span>   <span class="k">return</span> <span class="n">gaussian_filter</span><span class="p">(</span><span class="n">block</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">filt</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">map_blocks</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
</pre></div>
</div>
<p>While in this case we used a SciPy function, any arbitrary function could have been
used instead. This is a good interaction point with <a class="reference external" href="https://numba.pydata.org/">Numba</a>.</p>
<p>If your function does not preserve the shape of the block, then you will need to
provide a <code class="docutils literal notranslate"><span class="pre">chunks</span></code> keyword argument. If your block size is regular, then this
argument can take a block shape of, for example, <code class="docutils literal notranslate"><span class="pre">(1000,</span> <span class="pre">1000)</span></code>. In case of
irregular block sizes, it must be a tuple with the full chunks shape like
<code class="docutils literal notranslate"><span class="pre">((1000,</span> <span class="pre">700,</span> <span class="pre">1000),</span> <span class="pre">(200,</span> <span class="pre">300))</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">g</span><span class="o">.</span><span class="n">map_blocks</span><span class="p">(</span><span class="n">myfunc</span><span class="p">,</span> <span class="n">chunks</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
</pre></div>
</div>
<p>If your function needs to know the location of the block on which it operates,
you can give your function a keyword argument <code class="docutils literal notranslate"><span class="pre">block_id</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="n">block</span><span class="p">,</span> <span class="n">block_id</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="o">...</span>
</pre></div>
</div>
<p>This extra keyword argument will be given a tuple that provides the block
location like <code class="docutils literal notranslate"><span class="pre">(0,</span> <span class="pre">0)</span></code> for the upper-left block or <code class="docutils literal notranslate"><span class="pre">(0,</span> <span class="pre">1)</span></code> for the block
just to the right of that block.</p>
</div>
<div class="section" id="trim-excess">
<h2>Trim Excess<a class="headerlink" href="#trim-excess" title="Permalink to this headline">¶</a></h2>
<p>After mapping a blocked function, you may want to trim off the borders from each
block by the same amount by which they were expanded.  The function
<code class="docutils literal notranslate"><span class="pre">trim_internal</span></code> is useful here and takes the same <code class="docutils literal notranslate"><span class="pre">depth</span></code> argument
given to <code class="docutils literal notranslate"><span class="pre">overlap</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span><span class="o">.</span><span class="n">chunks</span>
<span class="go">((10, 10, 10, 10), (10, 10, 10, 10))</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">y</span> <span class="o">=</span> <span class="n">da</span><span class="o">.</span><span class="n">overlap</span><span class="o">.</span><span class="n">trim_internal</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="mi">1</span><span class="p">})</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">y</span><span class="o">.</span><span class="n">chunks</span>
<span class="go">((6, 6, 6, 6), (8, 8, 8, 8))</span>
</pre></div>
</div>
</div>
<div class="section" id="full-workflow">
<h2>Full Workflow<a class="headerlink" href="#full-workflow" title="Permalink to this headline">¶</a></h2>
<p>And so, a pretty typical overlapping workflow includes <code class="docutils literal notranslate"><span class="pre">overlap</span></code>, <code class="docutils literal notranslate"><span class="pre">map_blocks</span></code>
and <code class="docutils literal notranslate"><span class="pre">trim_internal</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="o">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">g</span> <span class="o">=</span> <span class="n">da</span><span class="o">.</span><span class="n">overlap</span><span class="o">.</span><span class="n">overlap</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">depth</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="mi">2</span><span class="p">},</span>
<span class="gp">... </span>                      <span class="n">boundary</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s1">&#39;periodic&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="s1">&#39;periodic&#39;</span><span class="p">})</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">g2</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">map_blocks</span><span class="p">(</span><span class="n">myfunc</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="n">da</span><span class="o">.</span><span class="n">overlap</span><span class="o">.</span><span class="n">trim_internal</span><span class="p">(</span><span class="n">g2</span><span class="p">,</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="mi">2</span><span class="p">})</span>
</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="array-design.html" class="btn btn-neutral float-right" title="Internal Design" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="array-creation.html" class="btn btn-neutral float-left" title="Create Dask Arrays" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2014-2018, Anaconda, Inc. and contributors

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>