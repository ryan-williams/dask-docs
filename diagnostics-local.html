








<!DOCTYPE html>
<html lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Diagnostics (local) &mdash; Dask 2.13.0+4.gf26bb993.dirty documentation</title>
  

  
  
  
  

  
  <link rel="stylesheet" href="_static/css/style.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/theme_overrides.css" type="text/css" />
  <link rel="stylesheet" href="_static/style.css" type="text/css" />
  <link rel="stylesheet" href="_static/css/explore.css" type="text/css" />
  <link rel="stylesheet" href="_static/css/nbsphinx.css" type="text/css" />

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/language_data.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
        <script src="_static/js/custom.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Diagnostics (distributed)" href="diagnostics-distributed.html" />
    <link rel="prev" title="Visualize task graphs" href="graphviz.html" />
    <link rel="shortcut icon" href="_static/images/favicon.ico"/>
  
</head>

<body class="wy-body-for-nav">

  
    <nav id="explore-links">
        <a href="https://docs.dask.org/">
        <img class="caption" src="_static/images/dask-horizontal-white.svg"/>
        </a>

        <ul>
        <li>
            <a>Get Started</a>
            <ul>
            <li><a href="https://docs.dask.org/en/latest/install.html"> Install </a></li>
            <li><a href="https://examples.dask.org"> Examples </a></li>
            <li><a href="https://github.com/dask/dask-tutorial"> Tutorial </a></li>
            <li><a href="https://docs.dask.org/en/latest/why.html"> Why Dask? </a></li>
            <li><a href="https://stories.dask.org/en/latest"> Use Cases </a></li>
            <li><a href="https://www.youtube.com/watch?v=RA_2qdipVng&list=PLRtz5iA93T4PQvWuoMnIyEIz1fXiJ5Pri"> Talks </a></li>
            <li><a href="https://mybinder.org/v2/gh/dask/dask-examples/master?urlpath=lab"> Try Online </a></li>
            <li><a href="https://dask.org/slides"> Slides </a></li>
            </ul>
        </li>

        <li>
            <a href="">Algorithms</a>
            <ul>
            <li><a href="https://docs.dask.org/en/latest/array.html">Arrays</a></li>
            <li><a href="https://docs.dask.org/en/latest/dataframe.html">Dataframes</a></li>
            <li><a href="https://docs.dask.org/en/latest/bag.html">Bags</a></li>
            <li><a href="https://docs.dask.org/en/latest/delayed.html">Delayed (custom)</a></li>
            <li><a href="https://docs.dask.org/en/latest/futures.html">Futures (real-time)</a></li>
            <li><a href="http://ml.dask.org">Machine Learning</a></li>
            <li><a href="https://xarray.pydata.org/en/latest/">XArray</a></li>
            </ul>
        </li>

        <li>
            <a href="https://docs.dask.org/en/latest/setup.html">Setup</a>
            <ul>
            <li><a href="https://docs.dask.org/en/latest/setup/single-machine.html"> Local </a></li>
            <li><a href="https://docs.dask.org/en/latest/setup/cloud.html"> Cloud </a></li>
            <li><a href="https://docs.dask.org/en/latest/setup/hpc.html"> HPC </a></li>
            <li><a href="https://kubernetes.dask.org/en/latest/"> Kubernetes </a></li>
            <li><a href="https://yarn.dask.org/en/latest/"> Hadoop / Yarn </a></li>
            </ul>
        </li>

        <li>
            <a>Community</a>
            <ul>
            <li><a href="http://docs.dask.org/en/latest/support.html">Ask for Help</a></li>
            <li><a href="https://github.com/dask">Github</a></li>
            <li><a href="https://stackoverflow.com/questions/tagged/dask">Stack Overflow</a></li>
            <li><a href="https://twitter.com/dask_dev">Twitter</a></li>
            <li><a href="https://blog.dask.org/"> Developer Blog </a></li>
            </ul>
        </li>
        </ul>

    </nav>
  
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home" alt="Documentation Home"> Dask
          

          
          </a>

          
            
            
              <div class="version">
                2.13.0+4.gf26bb993.dirty
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="install.html">Install Dask</a></li>
<li class="toctree-l1"><a class="reference internal" href="setup.html">Setup</a></li>
<li class="toctree-l1"><a class="reference external" href="https://stories.dask.org">Use Cases</a></li>
<li class="toctree-l1"><a class="reference internal" href="support.html">Community</a></li>
<li class="toctree-l1"><a class="reference internal" href="why.html">Why Dask?</a></li>
<li class="toctree-l1"><a class="reference internal" href="institutional-faq.html">Institutional FAQ</a></li>
</ul>
<p class="caption"><span class="caption-text">User Interface</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="user-interfaces.html">User Interfaces</a></li>
<li class="toctree-l1"><a class="reference internal" href="array.html">Array</a></li>
<li class="toctree-l1"><a class="reference internal" href="bag.html">Bag</a></li>
<li class="toctree-l1"><a class="reference internal" href="dataframe.html">DataFrame</a></li>
<li class="toctree-l1"><a class="reference internal" href="delayed.html">Delayed</a></li>
<li class="toctree-l1"><a class="reference internal" href="futures.html">Futures</a></li>
<li class="toctree-l1"><a class="reference external" href="https://ml.dask.org">Machine Learning</a></li>
<li class="toctree-l1"><a class="reference internal" href="best-practices.html">Best Practices</a></li>
<li class="toctree-l1"><a class="reference internal" href="api.html">API</a></li>
</ul>
<p class="caption"><span class="caption-text">Scheduling</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="scheduling.html">Scheduling</a></li>
<li class="toctree-l1"><a class="reference external" href="https://distributed.dask.org/">Distributed Scheduling</a></li>
</ul>
<p class="caption"><span class="caption-text">Diagnostics</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="understanding-performance.html">Understanding Performance</a></li>
<li class="toctree-l1"><a class="reference internal" href="graphviz.html">Visualize task graphs</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Diagnostics (local)</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#progress-bar">Progress Bar</a></li>
<li class="toctree-l2"><a class="reference internal" href="#profiler">Profiler</a></li>
<li class="toctree-l2"><a class="reference internal" href="#resourceprofiler">ResourceProfiler</a></li>
<li class="toctree-l2"><a class="reference internal" href="#cacheprofiler">CacheProfiler</a></li>
<li class="toctree-l2"><a class="reference internal" href="#example">Example</a></li>
<li class="toctree-l2"><a class="reference internal" href="#custom-callbacks">Custom Callbacks</a></li>
<li class="toctree-l2"><a class="reference internal" href="#api">API</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="diagnostics-distributed.html">Diagnostics (distributed)</a></li>
<li class="toctree-l1"><a class="reference internal" href="debugging.html">Debugging</a></li>
</ul>
<p class="caption"><span class="caption-text">Help &amp; reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="develop.html">Development Guidelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="changelog.html">Changelog</a></li>
<li class="toctree-l1"><a class="reference internal" href="configuration.html">Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="educational-resources.html">Educational Resources</a></li>
<li class="toctree-l1"><a class="reference internal" href="presentations.html">Presentations On Dask</a></li>
<li class="toctree-l1"><a class="reference internal" href="cheatsheet.html">Dask Cheat Sheet</a></li>
<li class="toctree-l1"><a class="reference internal" href="spark.html">Comparison to Spark</a></li>
<li class="toctree-l1"><a class="reference internal" href="caching.html">Opportunistic Caching</a></li>
<li class="toctree-l1"><a class="reference internal" href="graphs.html">Task Graphs</a></li>
<li class="toctree-l1"><a class="reference internal" href="remote-data-services.html">Remote Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="gpu.html">GPUs</a></li>
<li class="toctree-l1"><a class="reference internal" href="cite.html">Citations</a></li>
<li class="toctree-l1"><a class="reference internal" href="funding.html">Funding</a></li>
<li class="toctree-l1"><a class="reference internal" href="logos.html">Images and Logos</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Dask</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Diagnostics (local)</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/diagnostics-local.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="diagnostics-local">
<h1>Diagnostics (local)<a class="headerlink" href="#diagnostics-local" title="Permalink to this headline">¶</a></h1>
<p>Profiling parallel code can be challenging, but <code class="docutils literal notranslate"><span class="pre">dask.diagnostics</span></code> provides
functionality to aid in profiling and inspecting execution with the
<a class="reference internal" href="scheduling.html"><span class="doc">local task scheduler</span></a>.</p>
<p>This page describes the following few built-in options:</p>
<ol class="arabic simple">
<li><p>ProgressBar</p></li>
<li><p>Profiler</p></li>
<li><p>ResourceProfiler</p></li>
<li><p>CacheProfiler</p></li>
</ol>
<p>Furthermore, this page then provides instructions on how to build your own custom diagnostic.</p>
<div class="section" id="progress-bar">
<h2>Progress Bar<a class="headerlink" href="#progress-bar" title="Permalink to this headline">¶</a></h2>
<table class="longtable docutils align-default">
<colgroup>
<col style="width: 10%" />
<col style="width: 90%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><a class="reference internal" href="#dask.diagnostics.ProgressBar" title="dask.diagnostics.ProgressBar"><code class="xref py py-obj docutils literal notranslate"><span class="pre">ProgressBar</span></code></a>([minimum, width, dt, out])</p></td>
<td><p>A progress bar for dask.</p></td>
</tr>
</tbody>
</table>
<p>The <code class="docutils literal notranslate"><span class="pre">ProgressBar</span></code> class builds on the scheduler callbacks described above to
display a progress bar in the terminal or notebook during computation. This can
give a nice feedback during long running graph execution. It can be used as a
context manager around calls to <code class="docutils literal notranslate"><span class="pre">get</span></code> or <code class="docutils literal notranslate"><span class="pre">compute</span></code> to profile the
computation:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">dask.diagnostics</span> <span class="kn">import</span> <span class="n">ProgressBar</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">da</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">10000</span><span class="p">,</span> <span class="mi">10000</span><span class="p">),</span> <span class="n">chunks</span><span class="o">=</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">1000</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">res</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="k">with</span> <span class="n">ProgressBar</span><span class="p">():</span>
<span class="gp">... </span>    <span class="n">out</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span>
<span class="go">[########################################] | 100% Completed | 17.1 s</span>
</pre></div>
</div>
<p>or registered globally using the <code class="docutils literal notranslate"><span class="pre">register</span></code> method:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">pbar</span> <span class="o">=</span> <span class="n">ProgressBar</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pbar</span><span class="o">.</span><span class="n">register</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">out</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span>
<span class="go">[########################################] | 100% Completed | 17.1 s</span>
</pre></div>
</div>
<p>To unregister from the global callbacks, call the <code class="docutils literal notranslate"><span class="pre">unregister</span></code> method:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">pbar</span><span class="o">.</span><span class="n">unregister</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="profiler">
<h2>Profiler<a class="headerlink" href="#profiler" title="Permalink to this headline">¶</a></h2>
<table class="longtable docutils align-default">
<colgroup>
<col style="width: 10%" />
<col style="width: 90%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><a class="reference internal" href="#dask.diagnostics.Profiler" title="dask.diagnostics.Profiler"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Profiler</span></code></a>()</p></td>
<td><p>A profiler for dask execution at the task level.</p></td>
</tr>
</tbody>
</table>
<p>Dask provides a few tools for profiling execution. As with the <code class="docutils literal notranslate"><span class="pre">ProgressBar</span></code>,
they each can be used as context managers or registered globally.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">Profiler</span></code> class is used to profile Dask’s execution at the task level.
During execution, it records the following information for each task:</p>
<ol class="arabic simple">
<li><p>Key</p></li>
<li><p>Task</p></li>
<li><p>Start time in seconds since the epoch</p></li>
<li><p>Finish time in seconds since the epoch</p></li>
<li><p>Worker id</p></li>
</ol>
</div>
<div class="section" id="resourceprofiler">
<h2>ResourceProfiler<a class="headerlink" href="#resourceprofiler" title="Permalink to this headline">¶</a></h2>
<table class="longtable docutils align-default">
<colgroup>
<col style="width: 10%" />
<col style="width: 90%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><a class="reference internal" href="#dask.diagnostics.ResourceProfiler" title="dask.diagnostics.ResourceProfiler"><code class="xref py py-obj docutils literal notranslate"><span class="pre">ResourceProfiler</span></code></a>([dt])</p></td>
<td><p>A profiler for resource use.</p></td>
</tr>
</tbody>
</table>
<p>The <code class="docutils literal notranslate"><span class="pre">ResourceProfiler</span></code> class is used to profile Dask’s execution at the
resource level. During execution, it records the following information
for each timestep:</p>
<ol class="arabic simple">
<li><p>Time in seconds since the epoch</p></li>
<li><p>Memory usage in MB</p></li>
<li><p>% CPU usage</p></li>
</ol>
<p>The default timestep is 1 second, but can be set manually using the <code class="docutils literal notranslate"><span class="pre">dt</span></code>
keyword:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">dask.diagnostics</span> <span class="kn">import</span> <span class="n">ResourceProfiler</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">rprof</span> <span class="o">=</span> <span class="n">ResourceProfiler</span><span class="p">(</span><span class="n">dt</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="cacheprofiler">
<h2>CacheProfiler<a class="headerlink" href="#cacheprofiler" title="Permalink to this headline">¶</a></h2>
<table class="longtable docutils align-default">
<colgroup>
<col style="width: 10%" />
<col style="width: 90%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><a class="reference internal" href="#dask.diagnostics.CacheProfiler" title="dask.diagnostics.CacheProfiler"><code class="xref py py-obj docutils literal notranslate"><span class="pre">CacheProfiler</span></code></a>([metric, metric_name])</p></td>
<td><p>A profiler for dask execution at the scheduler cache level.</p></td>
</tr>
</tbody>
</table>
<p>The <code class="docutils literal notranslate"><span class="pre">CacheProfiler</span></code> class is used to profile Dask’s execution at the scheduler
cache level. During execution, it records the following information for each
task:</p>
<ol class="arabic simple">
<li><p>Key</p></li>
<li><p>Task</p></li>
<li><p>Size metric</p></li>
<li><p>Cache entry time in seconds since the epoch</p></li>
<li><p>Cache exit time in seconds since the epoch</p></li>
</ol>
<p>Here the size metric is the output of a function called on the result of each
task. The default metric is to count each task (<code class="docutils literal notranslate"><span class="pre">metric</span></code> is 1 for all tasks).
Other functions may be used as a metric instead through the <code class="docutils literal notranslate"><span class="pre">metric</span></code> keyword.
For example, the <code class="docutils literal notranslate"><span class="pre">nbytes</span></code> function found in <code class="docutils literal notranslate"><span class="pre">cachey</span></code> can be used to measure
the number of bytes in the scheduler cache:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">dask.diagnostics</span> <span class="kn">import</span> <span class="n">CacheProfiler</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">cachey</span> <span class="kn">import</span> <span class="n">nbytes</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cprof</span> <span class="o">=</span> <span class="n">CacheProfiler</span><span class="p">(</span><span class="n">metric</span><span class="o">=</span><span class="n">nbytes</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="example">
<h2>Example<a class="headerlink" href="#example" title="Permalink to this headline">¶</a></h2>
<p>As an example to demonstrate using the diagnostics, we’ll profile some linear
algebra done with Dask Array. We’ll create a random array, take its QR
decomposition, and then reconstruct the initial array by multiplying the Q and
R components together. Note that since the profilers (and all diagnostics) are
just context managers, multiple profilers can be used in a with block:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">dask.array</span> <span class="k">as</span> <span class="nn">da</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">dask.diagnostics</span> <span class="kn">import</span> <span class="n">Profiler</span><span class="p">,</span> <span class="n">ResourceProfiler</span><span class="p">,</span> <span class="n">CacheProfiler</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">da</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">10000</span><span class="p">,</span> <span class="mi">1000</span><span class="p">),</span> <span class="n">chunks</span><span class="o">=</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">1000</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">q</span><span class="p">,</span> <span class="n">r</span> <span class="o">=</span> <span class="n">da</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">qr</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a2</span> <span class="o">=</span> <span class="n">q</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="k">with</span> <span class="n">Profiler</span><span class="p">()</span> <span class="k">as</span> <span class="n">prof</span><span class="p">,</span> <span class="n">ResourceProfiler</span><span class="p">(</span><span class="n">dt</span><span class="o">=</span><span class="mf">0.25</span><span class="p">)</span> <span class="k">as</span> <span class="n">rprof</span><span class="p">,</span>
<span class="gp">... </span>        <span class="n">CacheProfiler</span><span class="p">()</span> <span class="k">as</span> <span class="n">cprof</span><span class="p">:</span>
<span class="gp">... </span>    <span class="n">out</span> <span class="o">=</span> <span class="n">a2</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span>
</pre></div>
</div>
<p>The results of each profiler are stored in their <code class="docutils literal notranslate"><span class="pre">results</span></code> attribute as a
list of <code class="docutils literal notranslate"><span class="pre">namedtuple</span></code> objects:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">prof</span><span class="o">.</span><span class="n">results</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="go">TaskData(key=(&#39;tsqr-8d16e396b237bf7a731333130d310cb9_QR_st1&#39;, 5, 0),</span>
<span class="go">         task=(qr, (_apply_random, &#39;random_sample&#39;, 1060164455, (1000, 1000), (), {})),</span>
<span class="go">         start_time=1454368444.493292,</span>
<span class="go">         end_time=1454368444.902987,</span>
<span class="go">         worker_id=4466937856)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">rprof</span><span class="o">.</span><span class="n">results</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="go">ResourceData(time=1454368444.078748, mem=74.100736, cpu=0.0)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">cprof</span><span class="o">.</span><span class="n">results</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="go">CacheData(key=(&#39;tsqr-8d16e396b237bf7a731333130d310cb9_QR_st1&#39;, 7, 0),</span>
<span class="go">          task=(qr, (_apply_random, &#39;random_sample&#39;, 1310656009, (1000, 1000), (), {})),</span>
<span class="go">          metric=1,</span>
<span class="go">          cache_time=1454368444.49662,</span>
<span class="go">          free_time=1454368446.769452)</span>
</pre></div>
</div>
<p>These can be analyzed separately or viewed in a bokeh plot using the provided
<code class="docutils literal notranslate"><span class="pre">visualize</span></code> method on each profiler:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">prof</span><span class="o">.</span><span class="n">visualize</span><span class="p">()</span>
</pre></div>
</div>
<iframe src="_static/profile.html"
        marginwidth="0" marginheight="0" scrolling="no"
        width="650" height="300" style="border:none"></iframe><p>To view multiple profilers at the same time, the <code class="docutils literal notranslate"><span class="pre">dask.diagnostics.visualize</span></code>
function can be used. This takes a list of profilers and creates a vertical
stack of plots aligned along the x-axis:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">dask.diagnostics</span> <span class="kn">import</span> <span class="n">visualize</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">visualize</span><span class="p">([</span><span class="n">prof</span><span class="p">,</span> <span class="n">rprof</span><span class="p">,</span> <span class="n">cprof</span><span class="p">])</span>
</pre></div>
</div>
<iframe src="_static/stacked_profile.html"
        marginwidth="0" marginheight="0" scrolling="no"
        width="650" height="700" style="border:none"></iframe><p>Looking at the above figure, from top to bottom:</p>
<ol class="arabic simple">
<li><p>The results from the <code class="docutils literal notranslate"><span class="pre">Profiler</span></code> object: This shows the execution time for
each task as a rectangle, organized along the y-axis by worker (in this case
threads). Similar tasks are grouped by color and, by hovering over each task,
one can see the key and task that each block represents.</p></li>
<li><p>The results from the <code class="docutils literal notranslate"><span class="pre">ResourceProfiler</span></code> object: This shows two lines, one
for total CPU percentage used by all the workers, and one for total memory
usage.</p></li>
<li><p>The results from the <code class="docutils literal notranslate"><span class="pre">CacheProfiler</span></code> object: This shows a line for each
task group, plotting the sum of the current <code class="docutils literal notranslate"><span class="pre">metric</span></code> in the cache against
time. In this case it’s the default metric (count) and the lines represent
the number of each object in the cache at time. Note that the grouping and
coloring is the same as for the <code class="docutils literal notranslate"><span class="pre">Profiler</span></code> plot, and that the task
represented by each line can be found by hovering over the line.</p></li>
</ol>
<p>From these plots we can see that the initial tasks (calls to
<code class="docutils literal notranslate"><span class="pre">numpy.random.random</span></code> and <code class="docutils literal notranslate"><span class="pre">numpy.linalg.qr</span></code> for each chunk) are run
concurrently, but only use slightly more than 100% CPU. This is because the
call to <code class="docutils literal notranslate"><span class="pre">numpy.linalg.qr</span></code> currently doesn’t release the Global Interpreter
Lock (GIL), so those calls can’t truly be done in parallel. Next, there’s a reduction
step where all the blocks are combined. This requires all the results from the
first step to be held in memory, as shown by the increased number of results in
the cache, and increase in memory usage. Immediately after this task ends, the
number of elements in the cache decreases, showing that they were only needed
for this step. Finally, there’s an interleaved set of calls to <code class="docutils literal notranslate"><span class="pre">dot</span></code> and
<code class="docutils literal notranslate"><span class="pre">sum</span></code>. Looking at the CPU plot, it shows that these run both concurrently and in
parallel, as the CPU percentage spikes up to around 350%.</p>
</div>
<div class="section" id="custom-callbacks">
<h2>Custom Callbacks<a class="headerlink" href="#custom-callbacks" title="Permalink to this headline">¶</a></h2>
<table class="longtable docutils align-default">
<colgroup>
<col style="width: 10%" />
<col style="width: 90%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><a class="reference internal" href="#dask.diagnostics.Callback" title="dask.diagnostics.Callback"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Callback</span></code></a>([start, start_state, pretask, …])</p></td>
<td><p>Base class for using the callback mechanism</p></td>
</tr>
</tbody>
</table>
<p>Schedulers based on <code class="docutils literal notranslate"><span class="pre">dask.local.get_async</span></code> (currently
<code class="docutils literal notranslate"><span class="pre">dask.get</span></code>, <code class="docutils literal notranslate"><span class="pre">dask.threaded.get</span></code>, and <code class="docutils literal notranslate"><span class="pre">dask.multiprocessing.get</span></code>)
accept five callbacks, allowing for inspection of scheduler execution.</p>
<p>The callbacks are:</p>
<p>1. <code class="docutils literal notranslate"><span class="pre">start(dsk)</span></code>: Run at the beginning of execution, right before the
state is initialized.  Receives the Dask graph</p>
<p>2. <code class="docutils literal notranslate"><span class="pre">start_state(dsk,</span> <span class="pre">state)</span></code>: Run at the beginning of execution, right
after the state is initialized.  Receives the Dask graph and scheduler state</p>
<p>3. <code class="docutils literal notranslate"><span class="pre">pretask(key,</span> <span class="pre">dsk,</span> <span class="pre">state)</span></code>: Run every time a new task is started.
Receives the key of the task to be run, the Dask graph, and the scheduler state</p>
<p>4. <code class="docutils literal notranslate"><span class="pre">posttask(key,</span> <span class="pre">result,</span> <span class="pre">dsk,</span> <span class="pre">state,</span> <span class="pre">id)</span></code>: Run every time a task is finished.
Receives the key of the task that just completed, the result, the Dask graph,
the scheduler state, and the id of the worker that ran the task</p>
<p>5. <code class="docutils literal notranslate"><span class="pre">finish(dsk,</span> <span class="pre">state,</span> <span class="pre">errored)</span></code>: Run at the end of execution, right before the
result is returned. Receives the Dask graph, the scheduler state, and a boolean
indicating whether or not the exit was due to an error</p>
<p>Custom diagnostics can be created either by instantiating the <code class="docutils literal notranslate"><span class="pre">Callback</span></code>
class with the some of the above methods as keywords or by subclassing the
<code class="docutils literal notranslate"><span class="pre">Callback</span></code> class.
Here we create a class that prints the name of every key as it’s computed:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">dask.callbacks</span> <span class="kn">import</span> <span class="n">Callback</span>
<span class="k">class</span> <span class="nc">PrintKeys</span><span class="p">(</span><span class="n">Callback</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">_pretask</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">dask</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Print the key of every task as it&#39;s started&quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Computing: </span><span class="si">{0}</span><span class="s2">!&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">key</span><span class="p">)))</span>
</pre></div>
</div>
<p>This can now be used as a context manager during computation:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">operator</span> <span class="kn">import</span> <span class="n">add</span><span class="p">,</span> <span class="n">mul</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dsk</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">add</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">add</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">),</span> <span class="s1">&#39;c&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">mul</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">)}</span>

<span class="gp">&gt;&gt;&gt; </span><span class="k">with</span> <span class="n">PrintKeys</span><span class="p">():</span>
<span class="gp">... </span>    <span class="n">get</span><span class="p">(</span><span class="n">dsk</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">)</span>
<span class="go">Computing &#39;a&#39;!</span>
<span class="go">Computing &#39;b&#39;!</span>
<span class="go">Computing &#39;c&#39;!</span>
</pre></div>
</div>
<p>Alternatively, functions may be passed in as keyword arguments to <code class="docutils literal notranslate"><span class="pre">Callback</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">printkeys</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">dask</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
<span class="gp">... </span>   <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Computing: </span><span class="si">{0}</span><span class="s2">!&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">key</span><span class="p">)))</span>

<span class="gp">&gt;&gt;&gt; </span><span class="k">with</span> <span class="n">Callback</span><span class="p">(</span><span class="n">pretask</span><span class="o">=</span><span class="n">printkeys</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">get</span><span class="p">(</span><span class="n">dsk</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">)</span>
<span class="go">Computing &#39;a&#39;!</span>
<span class="go">Computing &#39;b&#39;!</span>
<span class="go">Computing &#39;c&#39;!</span>
</pre></div>
</div>
</div>
<div class="section" id="api">
<h2>API<a class="headerlink" href="#api" title="Permalink to this headline">¶</a></h2>
<table class="longtable docutils align-default">
<colgroup>
<col style="width: 10%" />
<col style="width: 90%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><a class="reference internal" href="#dask.diagnostics.CacheProfiler" title="dask.diagnostics.CacheProfiler"><code class="xref py py-obj docutils literal notranslate"><span class="pre">CacheProfiler</span></code></a>([metric, metric_name])</p></td>
<td><p>A profiler for dask execution at the scheduler cache level.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#dask.diagnostics.Callback" title="dask.diagnostics.Callback"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Callback</span></code></a>([start, start_state, pretask, …])</p></td>
<td><p>Base class for using the callback mechanism</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#dask.diagnostics.Profiler" title="dask.diagnostics.Profiler"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Profiler</span></code></a>()</p></td>
<td><p>A profiler for dask execution at the task level.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#dask.diagnostics.ProgressBar" title="dask.diagnostics.ProgressBar"><code class="xref py py-obj docutils literal notranslate"><span class="pre">ProgressBar</span></code></a>([minimum, width, dt, out])</p></td>
<td><p>A progress bar for dask.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#dask.diagnostics.ResourceProfiler" title="dask.diagnostics.ResourceProfiler"><code class="xref py py-obj docutils literal notranslate"><span class="pre">ResourceProfiler</span></code></a>([dt])</p></td>
<td><p>A profiler for resource use.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#dask.diagnostics.visualize" title="dask.diagnostics.visualize"><code class="xref py py-obj docutils literal notranslate"><span class="pre">visualize</span></code></a>(profilers[, file_path, show, save])</p></td>
<td><p>Visualize the results of profiling in a bokeh plot.</p></td>
</tr>
</tbody>
</table>
<dl class="function">
<dt id="dask.diagnostics.ProgressBar">
<code class="sig-prename descclassname">dask.diagnostics.</code><code class="sig-name descname">ProgressBar</code><span class="sig-paren">(</span><em class="sig-param">minimum=0</em>, <em class="sig-param">width=40</em>, <em class="sig-param">dt=0.1</em>, <em class="sig-param">out=None</em><span class="sig-paren">)</span><a class="headerlink" href="#dask.diagnostics.ProgressBar" title="Permalink to this definition">¶</a></dt>
<dd><p>A progress bar for dask.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>minimum</strong><span class="classifier">int, optional</span></dt><dd><p>Minimum time threshold in seconds before displaying a progress bar.
Default is 0 (always display)</p>
</dd>
<dt><strong>width</strong><span class="classifier">int, optional</span></dt><dd><p>Width of the bar</p>
</dd>
<dt><strong>dt</strong><span class="classifier">float, optional</span></dt><dd><p>Update resolution in seconds, default is 0.1 seconds</p>
</dd>
</dl>
</dd>
</dl>
<p class="rubric">Examples</p>
<p>Below we create a progress bar with a minimum threshold of 1 second before
displaying. For cheap computations nothing is shown:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">with</span> <span class="n">ProgressBar</span><span class="p">(</span><span class="n">minimum</span><span class="o">=</span><span class="mf">1.0</span><span class="p">):</span>      
<span class="gp">... </span>    <span class="n">out</span> <span class="o">=</span> <span class="n">some_fast_computation</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span>
</pre></div>
</div>
<p>But for expensive computations a full progress bar is displayed:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">with</span> <span class="n">ProgressBar</span><span class="p">(</span><span class="n">minimum</span><span class="o">=</span><span class="mf">1.0</span><span class="p">):</span>      
<span class="gp">... </span>    <span class="n">out</span> <span class="o">=</span> <span class="n">some_slow_computation</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span>
<span class="go">[########################################] | 100% Completed | 10.4 s</span>
</pre></div>
</div>
<p>The duration of the last computation is available as an attribute</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">pbar</span> <span class="o">=</span> <span class="n">ProgressBar</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">with</span> <span class="n">pbar</span><span class="p">:</span>                          
<span class="gp">... </span>    <span class="n">out</span> <span class="o">=</span> <span class="n">some_computation</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span>
<span class="go">[########################################] | 100% Completed | 10.4 s</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pbar</span><span class="o">.</span><span class="n">last_duration</span>                  
<span class="go">10.4</span>
</pre></div>
</div>
<p>You can also register a progress bar so that it displays for all
computations:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">pbar</span> <span class="o">=</span> <span class="n">ProgressBar</span><span class="p">()</span>                
<span class="gp">&gt;&gt;&gt; </span><span class="n">pbar</span><span class="o">.</span><span class="n">register</span><span class="p">()</span>                     
<span class="gp">&gt;&gt;&gt; </span><span class="n">some_slow_computation</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span>     
<span class="go">[########################################] | 100% Completed | 10.4 s</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="dask.diagnostics.Profiler">
<code class="sig-prename descclassname">dask.diagnostics.</code><code class="sig-name descname">Profiler</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#dask.diagnostics.Profiler" title="Permalink to this definition">¶</a></dt>
<dd><p>A profiler for dask execution at the task level.</p>
<dl class="simple">
<dt>Records the following information for each task:</dt><dd><ol class="arabic simple">
<li><p>Key</p></li>
<li><p>Task</p></li>
<li><p>Start time in seconds since the epoch</p></li>
<li><p>Finish time in seconds since the epoch</p></li>
<li><p>Worker id</p></li>
</ol>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">operator</span> <span class="kn">import</span> <span class="n">add</span><span class="p">,</span> <span class="n">mul</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">dask.threaded</span> <span class="kn">import</span> <span class="n">get</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dsk</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">add</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="s1">&#39;z&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">mul</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">with</span> <span class="n">Profiler</span><span class="p">()</span> <span class="k">as</span> <span class="n">prof</span><span class="p">:</span>
<span class="gp">... </span>    <span class="n">get</span><span class="p">(</span><span class="n">dsk</span><span class="p">,</span> <span class="s1">&#39;z&#39;</span><span class="p">)</span>
<span class="go">22</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">prof</span><span class="o">.</span><span class="n">results</span>  
<span class="go">[(&#39;y&#39;, (add, &#39;x&#39;, 10), 1435352238.48039, 1435352238.480655, 140285575100160),</span>
<span class="go"> (&#39;z&#39;, (mul, &#39;y&#39;, 2), 1435352238.480657, 1435352238.480803, 140285566707456)]</span>
</pre></div>
</div>
<p>These results can be visualized in a bokeh plot using the <code class="docutils literal notranslate"><span class="pre">visualize</span></code>
method. Note that this requires bokeh to be installed.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">prof</span><span class="o">.</span><span class="n">visualize</span><span class="p">()</span> 
</pre></div>
</div>
<p>You can activate the profiler globally</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">prof</span><span class="o">.</span><span class="n">register</span><span class="p">()</span>  
</pre></div>
</div>
<p>If you use the profiler globally you will need to clear out old results
manually.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">prof</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="dask.diagnostics.ResourceProfiler">
<code class="sig-prename descclassname">dask.diagnostics.</code><code class="sig-name descname">ResourceProfiler</code><span class="sig-paren">(</span><em class="sig-param">dt=1</em><span class="sig-paren">)</span><a class="headerlink" href="#dask.diagnostics.ResourceProfiler" title="Permalink to this definition">¶</a></dt>
<dd><p>A profiler for resource use.</p>
<dl class="simple">
<dt>Records the following each timestep</dt><dd><ol class="arabic simple">
<li><p>Time in seconds since the epoch</p></li>
<li><p>Memory usage in MB</p></li>
<li><p>% CPU usage</p></li>
</ol>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">operator</span> <span class="kn">import</span> <span class="n">add</span><span class="p">,</span> <span class="n">mul</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">dask.threaded</span> <span class="kn">import</span> <span class="n">get</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dsk</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">add</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="s1">&#39;z&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">mul</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">with</span> <span class="n">ResourceProfiler</span><span class="p">()</span> <span class="k">as</span> <span class="n">prof</span><span class="p">:</span>  
<span class="gp">... </span>    <span class="n">get</span><span class="p">(</span><span class="n">dsk</span><span class="p">,</span> <span class="s1">&#39;z&#39;</span><span class="p">)</span>
<span class="go">22</span>
</pre></div>
</div>
<p>These results can be visualized in a bokeh plot using the <code class="docutils literal notranslate"><span class="pre">visualize</span></code>
method. Note that this requires bokeh to be installed.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">prof</span><span class="o">.</span><span class="n">visualize</span><span class="p">()</span> 
</pre></div>
</div>
<p>You can activate the profiler globally</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">prof</span><span class="o">.</span><span class="n">register</span><span class="p">()</span>  
</pre></div>
</div>
<p>If you use the profiler globally you will need to clear out old results
manually.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">prof</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>  
</pre></div>
</div>
<p>Note that when used as a context manager data will be collected throughout
the duration of the enclosed block. In contrast, when registered globally
data will only be collected while a dask scheduler is active.</p>
</dd></dl>

<dl class="function">
<dt id="dask.diagnostics.CacheProfiler">
<code class="sig-prename descclassname">dask.diagnostics.</code><code class="sig-name descname">CacheProfiler</code><span class="sig-paren">(</span><em class="sig-param">metric=None</em>, <em class="sig-param">metric_name=None</em><span class="sig-paren">)</span><a class="headerlink" href="#dask.diagnostics.CacheProfiler" title="Permalink to this definition">¶</a></dt>
<dd><p>A profiler for dask execution at the scheduler cache level.</p>
<dl class="simple">
<dt>Records the following information for each task:</dt><dd><ol class="arabic simple">
<li><p>Key</p></li>
<li><p>Task</p></li>
<li><p>Size metric</p></li>
<li><p>Cache entry time in seconds since the epoch</p></li>
<li><p>Cache exit time in seconds since the epoch</p></li>
</ol>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">operator</span> <span class="kn">import</span> <span class="n">add</span><span class="p">,</span> <span class="n">mul</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">dask.threaded</span> <span class="kn">import</span> <span class="n">get</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dsk</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">add</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="s1">&#39;z&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">mul</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">with</span> <span class="n">CacheProfiler</span><span class="p">()</span> <span class="k">as</span> <span class="n">prof</span><span class="p">:</span>
<span class="gp">... </span>    <span class="n">get</span><span class="p">(</span><span class="n">dsk</span><span class="p">,</span> <span class="s1">&#39;z&#39;</span><span class="p">)</span>
<span class="go">22</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">prof</span><span class="o">.</span><span class="n">results</span>    
<span class="go">[CacheData(&#39;y&#39;, (add, &#39;x&#39;, 10), 1, 1435352238.48039, 1435352238.480655),</span>
<span class="go"> CacheData(&#39;z&#39;, (mul, &#39;y&#39;, 2), 1, 1435352238.480657, 1435352238.480803)]</span>
</pre></div>
</div>
<p>The default is to count each task (<code class="docutils literal notranslate"><span class="pre">metric</span></code> is 1 for all tasks). Other
functions may used as a metric instead through the <code class="docutils literal notranslate"><span class="pre">metric</span></code> keyword. For
example, the <code class="docutils literal notranslate"><span class="pre">nbytes</span></code> function found in <code class="docutils literal notranslate"><span class="pre">cachey</span></code> can be used to measure
the number of bytes in the cache.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">cachey</span> <span class="kn">import</span> <span class="n">nbytes</span>    
<span class="gp">&gt;&gt;&gt; </span><span class="k">with</span> <span class="n">CacheProfiler</span><span class="p">(</span><span class="n">metric</span><span class="o">=</span><span class="n">nbytes</span><span class="p">)</span> <span class="k">as</span> <span class="n">prof</span><span class="p">:</span>  
<span class="gp">... </span>    <span class="n">get</span><span class="p">(</span><span class="n">dsk</span><span class="p">,</span> <span class="s1">&#39;z&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>The profiling results can be visualized in a bokeh plot using the
<code class="docutils literal notranslate"><span class="pre">visualize</span></code> method. Note that this requires bokeh to be installed.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">prof</span><span class="o">.</span><span class="n">visualize</span><span class="p">()</span> 
</pre></div>
</div>
<p>You can activate the profiler globally</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">prof</span><span class="o">.</span><span class="n">register</span><span class="p">()</span>  
</pre></div>
</div>
<p>If you use the profiler globally you will need to clear out old results
manually.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">prof</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="dask.diagnostics.Callback">
<code class="sig-prename descclassname">dask.diagnostics.</code><code class="sig-name descname">Callback</code><span class="sig-paren">(</span><em class="sig-param">start=None</em>, <em class="sig-param">start_state=None</em>, <em class="sig-param">pretask=None</em>, <em class="sig-param">posttask=None</em>, <em class="sig-param">finish=None</em><span class="sig-paren">)</span><a class="headerlink" href="#dask.diagnostics.Callback" title="Permalink to this definition">¶</a></dt>
<dd><p>Base class for using the callback mechanism</p>
<p>Create a callback with functions of the following signatures:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">start</span><span class="p">(</span><span class="n">dsk</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">pass</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">start_state</span><span class="p">(</span><span class="n">dsk</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">pass</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">pretask</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">dsk</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">pass</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">posttask</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">result</span><span class="p">,</span> <span class="n">dsk</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">worker_id</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">pass</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">finish</span><span class="p">(</span><span class="n">dsk</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">failed</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">pass</span>
</pre></div>
</div>
<p>You may then construct a callback object with any number of them</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">cb</span> <span class="o">=</span> <span class="n">Callback</span><span class="p">(</span><span class="n">pretask</span><span class="o">=</span><span class="n">pretask</span><span class="p">,</span> <span class="n">finish</span><span class="o">=</span><span class="n">finish</span><span class="p">)</span>  
</pre></div>
</div>
<p>And use it either as a context manager over a compute/get call</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">with</span> <span class="n">cb</span><span class="p">:</span>  
<span class="gp">... </span>    <span class="n">x</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span>  
</pre></div>
</div>
<p>Or globally with the <code class="docutils literal notranslate"><span class="pre">register</span></code> method</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">cb</span><span class="o">.</span><span class="n">register</span><span class="p">()</span>  
<span class="gp">&gt;&gt;&gt; </span><span class="n">cb</span><span class="o">.</span><span class="n">unregister</span><span class="p">()</span>  
</pre></div>
</div>
<p>Alternatively subclass the <code class="docutils literal notranslate"><span class="pre">Callback</span></code> class with your own methods.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">PrintKeys</span><span class="p">(</span><span class="n">Callback</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">_pretask</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">dask</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
<span class="gp">... </span>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Computing: </span><span class="si">{0}</span><span class="s2">!&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">key</span><span class="p">)))</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">with</span> <span class="n">PrintKeys</span><span class="p">():</span>  
<span class="gp">... </span>    <span class="n">x</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span>  
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="dask.diagnostics.visualize">
<code class="sig-prename descclassname">dask.diagnostics.</code><code class="sig-name descname">visualize</code><span class="sig-paren">(</span><em class="sig-param">profilers</em>, <em class="sig-param">file_path=None</em>, <em class="sig-param">show=True</em>, <em class="sig-param">save=True</em>, <em class="sig-param">**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#dask.diagnostics.visualize" title="Permalink to this definition">¶</a></dt>
<dd><p>Visualize the results of profiling in a bokeh plot.</p>
<p>If multiple profilers are passed in, the plots are stacked vertically.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>profilers</strong><span class="classifier">profiler or list</span></dt><dd><p>Profiler or list of profilers.</p>
</dd>
<dt><strong>file_path</strong><span class="classifier">string, optional</span></dt><dd><p>Name of the plot output file.</p>
</dd>
<dt><strong>show</strong><span class="classifier">boolean, optional</span></dt><dd><p>If True (default), the plot is opened in a browser.</p>
</dd>
<dt><strong>save</strong><span class="classifier">boolean, optional</span></dt><dd><p>If True (default), the plot is saved to disk.</p>
</dd>
<dt><strong>**kwargs</strong></dt><dd><p>Other keyword arguments, passed to bokeh.figure. These will override
all defaults set by visualize.</p>
</dd>
</dl>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><dl class="simple">
<dt><strong>The completed bokeh plot object.</strong></dt><dd></dd>
</dl>
</dd>
</dl>
</dd></dl>

</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="diagnostics-distributed.html" class="btn btn-neutral float-right" title="Diagnostics (distributed)" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="graphviz.html" class="btn btn-neutral float-left" title="Visualize task graphs" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2014-2018, Anaconda, Inc. and contributors

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>